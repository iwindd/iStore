model Category {
  id         Int         @id @default(autoincrement())
  label      String
  overstock  Boolean     @default(false)
  store_id   String
  creator_id Int?
  created_at DateTime    @default(now())
  updated_at DateTime    @updatedAt
  store      Store       @relation(fields: [store_id], references: [id])
  creator    Employee?   @relation(fields: [creator_id], references: [id])
  product    Product[]

  @@unique([label, store_id])
  @@map("categories")
}

model Product {
  id                     Int                      @id @default(autoincrement())
  serial                 String
  label                  String
  price                  Int                      @default(0)
  cost                   Int                      @default(0)
  sold                   Int                      @default(0)
  category_id            Int?
  store_id               String
  creator_id             Int?
  keywords               String                   @default("")
  usePreorder            Boolean                  @default(false)
  created_at             DateTime                 @default(now())
  updated_at             DateTime                 @updatedAt
  deleted_at             DateTime?

  store                  Store                   @relation(fields: [store_id], references: [id])
  category               Category?               @relation(fields: [category_id], references: [id], onDelete: SetNull)
  creator                Employee?               @relation(fields: [creator_id], references: [id])
  stockReceiptProducts   StockReceiptProduct[]
  promotionOfferBuyItems PromotionOfferBuyItem[]
  promotionOfferGetItems PromotionOfferGetItem[]
  orderProduct           OrderProduct[]
  orderPreOrders         OrderPreOrder[]
  stock           ProductStock?     
  productStockMovements  ProductStockMovement[]
  consignmentProducts ConsigmentProduct[]

  @@unique([serial,      store_id])
  @@map("products")
}

model ProductStock {
  id         Int      @id @default(autoincrement())
  quantity   Int      @default(0)
  useAlert   Boolean  @default(false)
  alertCount Int      @default(30)
  product_id Int      @unique
  updatedAt  DateTime @updatedAt

  product    Product  @relation(fields: [product_id], references: [id])

  @@map("product_stocks")
}

model ProductStockMovement{
  id                String        @id @default(cuid())
  type              ProductStockMovementType
  quantity          Int     
  quantity_before   Int
  quantity_after    Int
  product_id        Int
  stock_receipt_id  Int?
  order_id          Int?
  consignment_id    Int?
  createdAt         DateTime      @default(now())

  product           Product       @relation(fields: [product_id], references: [id])
  stock_receipt     StockReceipt? @relation(fields: [stock_receipt_id], references: [id])
  order             Order?        @relation(fields: [order_id], references: [id])
  consignment       Consignment?  @relation(fields: [consignment_id], references: [id])

  @@index([product_id])
  @@map("product_stock_movements")
}

enum ProductStockMovementType {
  SALE
  RECEIVE
  CANCEL
  ADJUST
  CONSIGNMENT
}