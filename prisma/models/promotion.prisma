model Event {
  id          Int       @id @default(autoincrement())
  name        String?   @db.VarChar(100) @default("Untitled") 
  note        String?   @db.VarChar(255)
  store_id    String
  creator_id  Int?
  start_at    DateTime
  end_at      DateTime
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  disabled_at DateTime?

  offers     PromotionOffer[]
  broadcasts Broadcast[]
  store      Store            @relation(fields: [store_id], references: [id])
  creator    Employee?        @relation(fields: [creator_id], references: [id])

  @@index([store_id])
  @@index([creator_id])
  @@index([store_id, disabled_at])
  @@index([store_id, start_at, end_at])
  @@map("events")
}

model PromotionOffer {
  id         Int      @id @default(autoincrement())
  event_id   Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  buyItems      PromotionOfferBuyItem[] @relation("BuyItems")
  getItems      PromotionOfferGetItem[] @relation("GetItems")
  event         Event                   @relation(fields: [event_id], references: [id], onDelete: Cascade)
  orderProducts OrderProduct[]

  @@index([event_id])
  @@map("promotion_offers")
}

model PromotionOfferBuyItem {
  id         Int @id @default(autoincrement())
  product_id Int
  quantity   Int @default(1)
  offer_id   Int

  product Product        @relation(fields: [product_id], references: [id], onDelete: Cascade)
  offer   PromotionOffer @relation("BuyItems", fields: [offer_id], references: [id])

  @@index([offer_id])
  @@index([product_id])
  @@map("promotion_offer_buy_items")
}

model PromotionOfferGetItem {
  id         Int @id @default(autoincrement())
  product_id Int
  quantity   Int @default(1)
  offer_id   Int

  product Product        @relation(fields: [product_id], references: [id], onDelete: Cascade)
  offer   PromotionOffer @relation("GetItems", fields: [offer_id], references: [id])

  @@index([offer_id])
  @@index([product_id])
  @@map("promotion_offer_get_items")
}
