model Order {
  id             Int       @id @default(autoincrement())
  cost           Decimal
  profit         Decimal
  total          Decimal
  method         Method    @default(CASH)
  type           OrderType @default(CASHOUT)
  note           String?
  store_id       String
  creator_id     Int?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  consignment_id Int?

  store                 Store                  @relation(fields: [store_id], references: [id])
  creator               Employee?              @relation(fields: [creator_id], references: [id])
  consignment           Consignment?           @relation(fields: [consignment_id], references: [id])
  products              OrderProduct[]
  preOrders             OrderPreOrder[]
  productStockMovements ProductStockMovement[]

  @@index([store_id])
  @@index([store_id, created_at])
  @@index([store_id, type])
  @@index([creator_id])
  @@map("orders")
}

model OrderProduct {
  id         Int     @id @default(autoincrement())
  order_id   Int
  product_id Int
  note       String?
  count      Int
  total      Decimal
  profit     Decimal
  cost       Decimal

  product         Product          @relation(fields: [product_id], references: [id])
  order           Order            @relation(fields: [order_id], references: [id])
  promotionOffers PromotionOffer[]

  @@index([order_id])
  @@index([product_id])
  @@map("order_products")
}

model OrderPreOrder {
  id              Int            @id @default(autoincrement())
  order_id        Int
  product_id      Int
  note            String?
  count           Int
  total           Decimal
  profit          Decimal
  cost            Decimal
  status          PreOrderStatus @default(PENDING)
  returned_at     DateTime?
  returned_by_id  Int?
  cancelled_at    DateTime?
  cancelled_by_id Int?

  product      Product   @relation(fields: [product_id], references: [id])
  order        Order     @relation(fields: [order_id], references: [id])
  returned_by  Employee? @relation("ReturnedPreOrders", fields: [returned_by_id], references: [id])
  cancelled_by Employee? @relation("CancelledPreOrders", fields: [cancelled_by_id], references: [id])

  @@index([order_id])
  @@index([product_id])
  @@index([status])
  @@map("order_preorders")
}

enum Method {
  CASH
  BANK
}

enum OrderType {
  CASHOUT
  PURCHASE
}

enum OrderProductType {
  NORMAL
  OFFER
}

enum PreOrderStatus {
  PENDING
  RETURNED
  CANCELLED
}
